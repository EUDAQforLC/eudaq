# build main EUDAQ library
FIND_PACKAGE(ROOT)
IF(ROOT_FOUND)
  INCLUDE_DIRECTORIES( ${ROOT_INCLUDE_DIR} )
  SET(ADDITIONAL_LIBRARIES ${ADDITIONAL_LIBRARIES}  ${ROOT_LIBRARIES})
  ADD_DEFINITIONS(-DROOT_FOUND)
ENDIF(ROOT_FOUND)

OPTION(USE_LCIO "Compiling main library using LCIO" OFF)
IF(USE_LCIO)
  FIND_PACKAGE(LCIO REQUIRED)
  INCLUDE_DIRECTORIES(${LCIO_INCLUDE_DIRS})
  SET(ADDITIONAL_LIBRARIES ${ADDITIONAL_LIBRARIES} ${LCIO_LIBRARIES} )
  ADD_DEFINITIONS(${LCIO_DEFINITIONS})
ENDIF(USE_LCIO)


ADD_SUBDIRECTORY(core)
ADD_SUBDIRECTORY(processors)

ADD_LIBRARY(${PROJECT_NAME} SHARED $<TARGET_OBJECTS:core> $<TARGET_OBJECTS:processors>) 
SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES VERSION ${EUDAQ_VERSION_MAJOR}.${EUDAQ_VERSION_MINOR})

GET_PROPERTY(PLUGIN_LIBS GLOBAL PROPERTY CONVERTER_PLUGIN)
TARGET_LINK_LIBRARIES(${PROJECT_NAME}  ${EUDAQ_THREADS_LIB} ${ADDITIONAL_LIBRARIES} ${PLUGIN_LIBS})

INSTALL(TARGETS ${PROJECT_NAME}
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib
  )
